version: '3.4'

services:
  andaha.gateways.ocelot:
    image: andaha-gateways-ocelot:${TAG}
    build:
      context: src/ApiGateways/Ocelot/Andaha.ApiGateways.Ocelot/
      dockerfile: Dockerfile

  andaha.services.identity:
    image: andaha-services-identity:${TAG}
    build:
      context: src/Services/Identity/Andaha.Services.Identity/
      dockerfile: Dockerfile
    depends_on: 
      - "andaha.services.identity.db"  

  andaha.services.identity.db:
    image: mcr.microsoft.com/mssql/server:2019-latest

  andaha.services.shopping:
    image: andaha-services-shopping:${TAG}
    build:
      context: src/Services/Shopping/Andaha.Services.Shopping/
      dockerfile: Dockerfile
      args:
        PatPlaceholder: ${NUGET_FEED_ACCESS_TOKEN}
    depends_on: 
      - "andaha.services.shopping.db"      

  andaha.services.shopping.db:
    image: mcr.microsoft.com/mssql/server:2019-latest    
